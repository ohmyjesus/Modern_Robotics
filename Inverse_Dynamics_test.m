q = thetamat';
dq = dthetamat';
ddq = dthetamat';

g = [0; 0; -9.8];
Ftip = [0; 0; 0; 0; 0; 0];

M01 = [[1, 0, 0, 0]; [0, 1, 0, 0]; [0, 0, 1, 0.089159]; [0, 0, 0, 1]];
M12 = [[0, 0, 1, 0.28]; [0, 1, 0, 0.13585]; [-1, 0 ,0, 0]; [0, 0, 0, 1]];
M23 = [[1, 0, 0, 0]; [0, 1, 0, -0.1197]; [0, 0, 1, 0.395]; [0, 0, 0, 1]];
M34 = [[1, 0, 0, 0]; [0, 1, 0, 0]; [0, 0, 1, 0.14225]; [0, 0, 0, 1]];
M45 = [[1, 0, 0, 0]; [0, 1, 0, 0]; [0, 0, 1, 0.14225]; [0, 0, 0, 1]];
M56 = [[1, 0, 0, 0]; [0, 1, 0, 0]; [0, 0, 1, 0.14225]; [0, 0, 0, 1]];
M67 = [[1, 0, 0, 0]; [0, 1, 0, 0]; [0, 0, 1, 0.14225]; [0, 0, 0, 1]];
Mlist = cat(3, M01, M12, M23, M34, M45, M56, M67); 

%连杆i的空间惯性矩阵
G1 = diag([0.010267, 0.010267, 0.00666, 3.7, 3.7, 3.7]);
G2 = diag([0.22689, 0.22689, 0.0151074, 8.393, 8.393, 8.393]);
G3 = diag([0.0494433, 0.0494433, 0.004095, 2.275, 2.275, 2.275]);
G4 = diag([0.0494433, 0.0494433, 0.004095, 2.275, 2.275, 2.275]);
G5 = diag([0.0494433, 0.0494433, 0.004095, 2.275, 2.275, 2.275]);
G6 = diag([0.0494433, 0.0494433, 0.004095, 2.275, 2.275, 2.275]);
Glist = cat(3, G1, G2, G3, G4, G5, G6);

w1 = [0;0;1]; %沿关节轴的单位向量 相对于基坐标系
w2 = [0;-1;0];
w3 = [0;-1;0];
w4 = [1;0;0];
w5 = [0;1;0];
w6 = [0;0;-1];

q1 = [0; 0; 0]; %qn是关节轴上任一点 坐标值在基坐标系中进行度量 
q2 = [169.9876; 0; -0.0121] ;
q3 = [170.0136; 0; 613.9879] ;
q4 = [0; -0.0112; 814.0441] ;
q5 = [810.0109; 0; 814.0039] ;
q6 = [810.0018; 0; 0];

v1 = -cross(w1,q1); %线速度
v2 = -cross(w2,q2);
v3 = -cross(w3,q3);
v4 = -cross(w4,q4);
v5 = -cross(w5,q5);
v6 = -cross(w6,q6);

%运动旋量S1-S6
Slist = [[w1;v1]  [w2;v2]  [w3;v3]  [w4;v4]  [w5;v5]  [w6;v6]];

for i = 1:length(q)
    taulist(:,i) = InverseDynamics(q, dq, ddq, g,  Ftip, Mlist, Glist, Slist);
end

% figure
% plot(taumat)

